# 후회 점수 계산 로직 가이드

## 개요

후회 점수는 **0-100점** 사이의 값으로, 점수가 높을수록 해당 구매에 대한 후회 가능성이 높습니다.

---

## 계산 요소 (7가지)

### 1. 필요도-사용빈도 갭 (최대 30점) ⭐ 핵심 지표

**설명**: 구매 당시 생각한 필요도와 실제 사용 빈도의 차이를 측정

**계산 방식**:
```
갭 = 필요도 - 사용빈도

갭 = 0 이하  → 0점   (사용빈도가 높거나 같음)
갭 = 1      → 5점   (약간의 후회)
갭 = 2      → 12점  (중간 후회)
갭 = 3      → 20점  (높은 후회)
갭 ≥ 4      → 30점  (매우 높은 후회)
```

**예시**:
- 필요도 5, 사용빈도 5 → 0점 (완벽한 구매!)
- 필요도 4, 사용빈도 2 → 12점 (생각보다 덜 사용함)
- 필요도 5, 사용빈도 1 → 30점 (거의 사용 안 함)

**추가된 이유**:
- 사용자가 직접 입력한 가장 정확한 후회 지표
- 구매 전후의 심리 변화를 직접 반영

---

### 2. 시간 경과 대비 사용빈도 (최대 15점)

**설명**: 오래전에 구매했는데 사용빈도가 낮으면 후회 점수 증가

**계산 방식**:
```
경과 일수별 가중치:
- 7일 미만    → 0 (판단하기 이름)
- 7-30일     → 0.3
- 30-90일    → 0.6
- 90-180일   → 0.9
- 180일 이상  → 1.2

점수 = (5 - 사용빈도) / 4 × 가중치 × 12
```

**예시**:
- 6개월 전 구매, 사용빈도 1 → 14.4점
- 1개월 전 구매, 사용빈도 5 → 0점
- 3개월 전 구매, 사용빈도 2 → 10.8점

**추가된 이유**:
- 시간이 지났는데도 사용 안 하는 것은 확실한 후회 신호
- 최근 구매는 아직 판단하기 이름

---

### 3. 금액 가중치 (최대 20점) 💰

**설명**: 고가 제품일수록 후회 시 심리적 부담이 크므로 가중치 증가

**계산 방식**:
```
점수 = (금액/평균금액 × 4) + (금액/최대금액 × 6) + (log₁₀(금액/1000) × 2)

특수 케이스:
- 1만원 이하 → 2점 (소액 구매)
```

**예시**:
- 5만원 제품 (평균 5만원) → 약 8점
- 50만원 제품 (평균 5만원) → 약 18점
- 5천원 제품 → 2점

**추가된 이유**:
- 같은 실수라도 금액이 크면 후회감이 더 큼
- 상대적 금액(평균 대비)과 절대적 금액 모두 고려

---

### 4. 최근성 (최대 10점) 🆕

**설명**: 최근 구매일수록 충동 구매 가능성이 높음

**계산 방식**:
```
경과 일수별 점수:
- 0-3일    → 8점  (매우 최근, 충동 구매 의심)
- 4-7일    → 6점
- 8-14일   → 4점
- 15-30일  → 2점
- 31일 이상 → 0점 (충분한 시간 경과)
```

**예시**:
- 어제 구매 → 8점
- 2주 전 구매 → 4점
- 2개월 전 구매 → 0점

**추가된 이유** (사용자 요청):
- 최근 구매일수록 가중치 증가
- 충동 구매는 대부분 짧은 시간 내에 발생

---

### 5. 카테고리 반복 구매 (최대 15점) 🔄

**설명**: 같은 카테고리를 짧은 시간 내 반복 구매 시 충동 구매 패턴

**계산 방식**:
```
현재 구매 날짜 기준 ±30일 이내 동일 카테고리 구매 건수:

1건 → 0점
2건 → 5점
3건 → 10점
4건 이상 → 15점
```

**예시**:
- "전자제품"을 한 달에 1번 → 0점
- "전자제품"을 한 달에 3번 → 10점
- "의류"를 3일 동안 4번 → 15점

**추가된 이유** (사용자 요청):
- 동일 카테고리 반복 구매 시 점수 상승
- 필요에 의한 구매라면 시간 간격이 있어야 함

---

### 6. 새벽 시간 구매 (최대 10점) 🌙

**설명**: 새벽 시간대 구매는 충동 구매 가능성이 높음

**계산 방식**:
```
구매 시간대별 점수:
- 00:00-05:00 (새벽)   → 10점
- 23:00-24:00 (심야)   → 7점
- 21:00-23:00 (늦은 밤) → 4점
- 기타                → 0점
- 시간 정보 없음        → 0점
```

**예시**:
- 새벽 2시 구매 → 10점
- 오후 3시 구매 → 0점
- 밤 11시 구매 → 4점

**추가된 이유** (사용자 요청):
- 새벽 시간 구매 시 가중치 추가
- 피로하거나 감정적일 때 충동 구매 증가

**참고**: CSV에 시간 정보가 없으면 0점 처리

---

### 7. 충동 구매 패턴 (최대 10점) ⚡

**설명**: 같은 날 여러 구매 또는 연속된 날짜에 구매 시 충동 패턴 감지

**계산 방식**:
```
같은 날 구매 건수:
- 4건 이상 → 10점
- 3건     → 7점
- 2건     → 4점

또는 3일 이내 구매 건수:
- 5건 이상 → 8점
- 3-4건   → 5점
- 2건     → 3점
```

**예시**:
- 하루에 5개 구매 → 10점
- 3일 동안 6개 구매 → 8점
- 일주일에 1개 구매 → 0점

**추가된 이유** (추가 조건):
- 충동 구매는 짧은 시간에 집중적으로 발생
- 쇼핑 중독 패턴 감지

---

## 총 점수 계산

```
총 후회 점수 = min(
    필요도갭 + 시간경과 + 금액가중치 + 최근성 + 반복구매 + 새벽구매 + 충동패턴,
    100
)
```

**최대값 제한**: 100점을 초과하지 않도록 제한

---

## 점수 해석

| 점수 범위 | 등급 | 의미 | 조치 |
|----------|------|------|------|
| **0-20** | 🟢 매우 만족 | 훌륭한 구매 | 이런 구매 패턴 유지 |
| **21-35** | 🟡 만족 | 괜찮은 구매 | 대체로 잘하고 있음 |
| **36-50** | 🟡 보통 | 그저 그런 구매 | 좀 더 신중 필요 |
| **51-65** | 🟠 아쉬움 | 아쉬운 구매 | 구매 패턴 점검 |
| **66-80** | 🔴 후회 | 후회되는 구매 | 습관 개선 필요 |
| **81-100** | 🔴 매우 후회 | 매우 후회되는 구매 | 충동 구매 패턴 개선 시급 |

---

## 실제 예시

### 예시 1: 훌륭한 구매 (총 3점)
```
상품: 겨울코트
금액: 150,000원
필요도: 5, 사용빈도: 5
구매일: 3개월 전

계산:
- 필요도갭: 0점 (5-5=0)
- 시간경과: 0점 (사용빈도 높음)
- 금액: 3점
- 최근성: 0점
- 반복구매: 0점
- 새벽구매: 0점
- 충동패턴: 0점
→ 총 3점 (매우 만족)
```

### 예시 2: 후회 구매 (총 68점)
```
상품: 스마트워치
금액: 280,000원
필요도: 5, 사용빈도: 1
구매일: 어제 새벽 2시

계산:
- 필요도갭: 30점 (5-1=4)
- 시간경과: 0점 (아직 판단 이름)
- 금액: 18점 (고가)
- 최근성: 8점 (어제)
- 반복구매: 10점 (한 달에 전자제품 3번)
- 새벽구매: 10점 (새벽 2시)
- 충동패턴: 7점 (같은 날 3건)
→ 총 83점 (매우 후회)
```

### 예시 3: 보통 구매 (총 42점)
```
상품: 책
금액: 18,000원
필요도: 4, 사용빈도: 3
구매일: 2주 전

계산:
- 필요도갭: 5점 (4-3=1)
- 시간경과: 2점
- 금액: 3점
- 최근성: 4점
- 반복구매: 5점
- 새벽구매: 0점
- 충동패턴: 0점
→ 총 19점 (만족)
```

---

## 추가 고려 사항

### 향후 개선 가능 항목

1. **계절성** (미구현)
   - 겨울에 여름옷 구매 등 계절에 맞지 않는 구매 감지
   - CSV에 계절 정보 없어 현재는 미적용

2. **소득 대비 금액** (미구현)
   - 사용자의 월 소득 정보가 있으면 상대적 고가 판단 가능
   - 프라이버시 이슈로 현재는 미적용

3. **카테고리별 가중치** (미구현)
   - 특정 카테고리(예: 전자제품)는 후회 가능성 높음
   - 데이터 수집 후 추후 적용 예정

4. **사용자 피드백** (미구현)
   - 실제 후회 여부를 사용자가 입력하면 정확도 향상
   - 2단계 이후 기능

---

## 사용 방법

### Python 코드
```python
from utils.regret_calculator import add_regret_scores_to_dataframe

# DataFrame에 후회 점수 추가
df_with_scores = add_regret_scores_to_dataframe(df)

# 결과 확인
print(df_with_scores[['상품명', '후회점수']].head())
```

### Streamlit 앱
1. CSV 업로드
2. 자동으로 후회 점수 계산
3. "후회 점수 분석" 섹션에서 결과 확인

---

## FAQ

**Q: 후회 점수가 높은데 실제로는 만족스러운 구매입니다. 왜 그런가요?**

A: 후회 점수는 통계적 패턴을 기반으로 계산됩니다. 개인의 특수한 상황은 반영되지 않을 수 있습니다. 예를 들어:
- 선물용 구매 (사용빈도는 낮지만 후회 없음)
- 수집품 (사용빈도는 낮지만 가치 있음)

**Q: 시간 정보가 없는 CSV를 사용하는데 새벽 구매 점수는 어떻게 되나요?**

A: 시간 정보가 없으면 새벽 구매 점수는 자동으로 0점 처리됩니다.

**Q: 후회 점수를 낮추려면 어떻게 해야 하나요?**

A:
1. 구매 전 진짜 필요한지 3일 고민하기
2. 새벽/늦은 밤에는 구매하지 않기
3. 같은 카테고리를 짧은 시간에 반복 구매하지 않기
4. 하루에 여러 건 구매하지 않기

---

**업데이트**: 2024-02-11
**버전**: 1.0.0
